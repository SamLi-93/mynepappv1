angular.module('mynepapp.controllers', [])

.controller('DashCtrl', function($scope) {})

.controller('ChatsCtrl', function($scope, Chats) {
  // With the new view caching in Ionic, Controllers are only called
  // when they are recreated or on app start, instead of every page change.
  // To listen for when this page is active (for example, to refresh data),
  // listen for the $ionicView.enter event:
  //
  //$scope.$on('$ionicView.enter', function(e) {
  //});

  $scope.chats = Chats.all();
  $scope.remove = function(chat) {
    Chats.remove(chat);
  };
})

.controller('leftmenuCtrl', ['$scope','$state','$ionicSideMenuDelegate','LoginService','Websites', function($scope,$state,$ionicSideMenuDelegate,LoginService,Websites){
    /**
     * 点击跳转到登录页面
     * @return {[type]} [description]
     */
    $scope.tologin = function(){
        console.log('tologin');
        $state.go('tab.usercenter');
        $ionicSideMenuDelegate.toggleLeft();
    };

    /**
     * 点击选择类别
     * @return {[type]} [description]
     */
    $scope.toCategory = function(catId){
        localStorage.catId = catId;
        //localStorage.catName = 
        console.log(catId);
        $state.go('tab.home',{catId:catId});
        $ionicSideMenuDelegate.toggleLeft();
    };

    /**
     * 得到分类数据
     */
    Websites.getCategory($scope);

    $scope.haslogin = typeof(localStorage.haslogin) == 'undefined'?0:localStorage.haslogin;
    $scope.username = localStorage.username;
    $scope.$on('loginUser', function() {
        console.log('listen on');
        //$scope.username = LoginService.getUser();
        $scope.haslogin = typeof(localStorage.haslogin) == 'undefined'?0:localStorage.haslogin;
        $scope.username = localStorage.username;
        console.log(window.localStorage['username']);
    });
}])

.controller('ChatDetailCtrl', function($scope, $stateParams, Chats) {
  $scope.chat = Chats.get($stateParams.chatId);
})

.controller('AppCtrl', function($scope, $ionicPopup, $ionicModal, $timeout, $http, $ionicLoading, $location, $state) {

})
/**
 * [我的订单]
 * [by潘]
 */
.controller('OrderCtrl', function($scope, $ionicPopup, $ionicModal, $timeout, $http, $ionicLoading, $location, $state,Websites) {
  if (localStorage.haslogin != 1) {
      $state.go("tab.usercenter");
  }
  $ionicLoading.show({
      template: 'Loading...'
  });
  Websites.getOrderlist($scope).success(function(data){
    $scope.orderlist = data;
  }).error(function(data){

  })
  $ionicLoading.hide();
  //订单下拉刷新
  $scope.doRefresh = function(){
    Websites.getOrderlist($scope).success(function(data){
      $scope.orderlist = data;
      $scope.$broadcast('scroll.refreshComplete');
    }).error(function(data){})
  }
  //取消订单
  $scope.ordercancel = function(index,id){
    var confirmPopup = $ionicPopup.confirm({
          title: '取消订单？',
          buttons: [{ //Array[Object] (可选)。放在弹窗footer内的按钮。
            text: '否',
            type: 'button-balanced',
          }, {
            text: '是',
            type: 'button-calm',
            onTap: function(e) {
              // 返回的值会导致处理给定的值。
              return true;
            }
          }]
      });

      confirmPopup.then(function(res) {
        if(res) {
          Websites.Ordercancel($scope,id).success(function(data){
            if(data.status=='1'){
              $scope.orderlist[index]['status'] = '2';
              $scope.showMessage('订单取消成功');
            }
          }).error(function(data){
            $scope.showMessage('订单取消失败');
          })
        }
      });

  }
  $scope.showMessage = function(title){
    $ionicLoading.show({
      template: title
    });
    $timeout(function() {
      $ionicLoading.hide();
    }, 1000);
  }

})

/**我的问答**/
.controller('AnswerlistCtrl', function($scope, Websites, $ionicPopup, $ionicModal, $timeout, $http, $ionicLoading, $location, $state,$ionicScrollDelegate) {
  if (localStorage.haslogin != 1) {
        $state.go("tab.usercenter");
  }
  console.log($scope);

  $ionicLoading.show({
      template: 'Loading...'
  });
  $scope.userid = window.localStorage['userid'];
  //获取帖子
  Websites.getAnswerlist($scope);
  $ionicLoading.hide();
  //设置发帖内容（默认为空）
  $scope.answercreate = {
    'title': '',
    'content': ''
  };
  $scope.setscroll = function(){
    $ionicScrollDelegate.resize();
  }
  //定义发帖视图
  $ionicModal.fromTemplateUrl('templates/answer-create.html', {
    scope: $scope
  }).then(function(modal) {
    $scope.answer = modal;
  });
  //帖子刷新
  $scope.doRefresh = function() {
    Websites.getAnswerlist($scope);
    //Stop the ion-refresher from spinning
    $scope.$broadcast('scroll.refreshComplete');
  }
  //推出发帖视图
  $scope.showanswer = function(){
    $scope.answer.show();
  } 
  //隐藏发帖视图
  $scope.closecreate = function(){
    $scope.answer.hide();
  } 
  $scope.create = function(){
    if ($scope.answercreate.title == ''  || $scope.answercreate.content == '' ) {
                var alertPopup = $ionicPopup.alert({
                    title: '格式不合法',
                    template: '请确认标题或内容不能为空！',
                    buttons: [{ //Array[Object] (可选)。放在弹窗footer内的按钮。
                      text: 'OK',
                      type: 'button-calm',
                    }]
                });
    }else{
      $http.jsonp(ENV.postUrl + 'apicatechism/create/userid/'+$scope.userid+'/title/'+$scope.answercreate.title+'/content/'+$scope.answercreate.content+'?callback=JSON_CALLBACK')
        .then(function(res){
          //console.log(res.data);
          //新发帖子添加到发帖列表
          $scope.answerlist.push(res.data);
          //console.log($scope.answerlist);
          //隐藏发帖视图
          $scope.answer.hide();
          //发帖成功清除数据
          $scope.answercreate = {
            'title': '',
            'content': ''
          };
      })
    }
  }
})

.controller('AnswerCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading) {
  if (localStorage.haslogin != 1) {
        $state.go("tab.usercenter");
  }
  $ionicLoading.show({
      template: 'Loading...'
  });
  var userid = window.localStorage['userid'];
  //帖子id
  $scope.answer_id = $stateParams.id;
  $scope.discuss = {'con':''};
  //获取帖子内容
  Websites.getAnswerDetail($scope);
  $ionicLoading.hide();
  $scope.answersubmit = function() {
    console.log($scope.discuss.con.length);
    $http.jsonp(ENV.postUrl + 'apicatechism/submit/userid/'+userid+'/id/'+$scope.answer_id+'/content/'+$scope.discuss.con+'?callback=JSON_CALLBACK')
      .then(function(res){
        var r_data = res.data;
        r_data.num = $scope.answerlist.length+1;
        //新发帖子添加到发帖列表
        //console.log($scope.answerlist.length);
        $scope.answerlist.push(r_data);
        //发帖成功清除数据
        $scope.discuss.con = "";
    })

  }
  $scope.doRefresh = function() {
    Websites.getAnswerDetail($scope);
    $scope.$broadcast('scroll.refreshComplete');
  }

})
.controller('LearnCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading,$rootScope) {
  if (localStorage.haslogin != 1) {
        $state.go("tab.usercenter");
  }
  //隐藏header-bar
  //$rootScope.showFooterBar.show = false;
  console.log($rootScope);
  $ionicLoading.show({
      template: 'Loading...'
  });
  //获取帖子内容
  //Websites.getAnswerDetail($scope);
  $ionicLoading.hide();
})
/*我的练习*/
.controller('PracticeCtrl', function($scope,$ionicPopup,$stateParams,Websites,$http,$ionicLoading,$rootScope,$ionicViewSwitcher) {
  if (localStorage.haslogin != 1) {
        $state.go("tab.usercenter");
  }
  /*//强制显示返回button，默认情况下tabs里面独立页面不显示back button
  $scope.$on('$ionicView.beforeEnter', function (event, viewData) {
      viewData.enableBack = true;
  });
  //返回的动画效果，默认情况下强制显示的返回button无动画效果
  $scope.$on('$ionicView.beforeLeave', function (event, viewData) {
      $ionicViewSwitcher.nextDirection("back");
  });*/

  $ionicLoading.show({
      template: 'Loading...'
  });
  var userid = window.localStorage['userid'];
  console.log('PracticeCtrl');
  //$scope.processhide = true;
  $scope.errornum = 0;
  /*Websites.getMonilist($scope,userid).success(function(data) {
  }).error(function(data) {
  });
  Websites.getErrorlist($scope,userid).success(function(data) {
    $scope.errornum = data.responseData.length;
    //$ionicLoading.hide();
    console.log(data);
  }).error(function(data){
    //加载失败
  });*/
  Websites.getPracticelist($scope,userid).success(function(data) {
    $scope.plist = data;
    console.log(data);
    //$ionicLoading.hide();
  }).error(function(data){
    //加载失败
  });
  $ionicLoading.hide();
//Sam   --------删除错题列表
  $scope.onItemDelete = function(){
    var confirmPopup = $ionicPopup.confirm({
          title: '确认删除？',
          cancelText: '取消',
          okText: '确定'
      });
      confirmPopup.then(function(res) {
        if(res) {
          console.log('You are sure');
          $http.get(ENV.postUrl + 'mobileerror/delete/userid/13/course_id/9')
            .then(function(res){
              console.log(res.data);
          })              
          $scope.errorlist = '';
        }else{
            console.log('You are not sure');
        }
      });
    console.log('test');
  }
})
//学习记录
.controller('RecordCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading,$rootScope,$state,$ionicViewSwitcher) {
  if (localStorage.haslogin != 1) {
        $state.go("tab.usercenter");
  }
  //强制显示返回button，默认情况下tabs里面独立页面不显示back button
  $scope.$on('$ionicView.beforeEnter', function (event, viewData) {
      viewData.enableBack = true;
  });
  //返回的动画效果，默认情况下强制显示的返回button无动画效果
  $scope.$on('$ionicView.beforeLeave', function (event, viewData) {
      $ionicViewSwitcher.nextDirection("back");
  });
  $scope.plan_empty = "";
  $scope.search_empty = "";
  $scope.process_empty = "";
  $ionicLoading.show({
      template: 'Loading...'
  });
  $scope.userid = window.localStorage['userid'];
  //教学计划
  Websites.getPlanlist($scope).success(function(data) {
    if($scope.planlist.length==0){
      $scope.plan_empty = "无教学计划";
    }
  }).error(function(data){
      //加载失败
      console.log('failure');
  });
  Websites.getSearchlist($scope).success(function(data) {
    if($scope.searchlist.length==0){
      $scope.search_empty = "无成绩查询";
    }
  }).error(function(data){
      //加载失败
      console.log('failure');
  });
  Websites.getProcesslist($scope).success(function(data) {
    if($scope.processlist.length==0){
      $scope.process_empty = "无学习进度";
    }
  }).error(function(data){
      //加载失败
      console.log('failure');
  });
  $ionicLoading.hide();
})
/**
 * [教学计划]
 * [by潘]
 */
.controller('PlanCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading,$rootScope,$ionicHistory) {
  $ionicLoading.show({
      template: 'Loading...'
  });
  $scope.userid = window.localStorage['userid'];
  //教学计划
  Websites.getPlanlist($scope);
  $ionicLoading.hide();
  $scope.back = function(){
    console.log(1);
    $ionicHistory.goBack();
  }
})
/**
 * [电子书列表]
 * [by潘]
 */
.controller('BooklistCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading,$rootScope,$ionicHistory) {
  
})
/**
 * [电子书内容]
 * [by潘]
 */
.controller('BookReadCtrl', function($scope,$stateParams,Websites,$http,$state,$ionicLoading,$rootScope,$ionicHistory,$ionicModal) {
  $scope.book = {'title':'完美世界','chapter_all':'12'};
  //var read_page = document.getElementById('read_page_con');
  //console.log(read_page);
  //.
  $scope.book.content ="第一章 我是杯具<br>烈焰大陆。<br>又是一年盛夏，天空中电闪雷鸣，外面下起了急剧的雷雨，那雷电的巨响甚至吓哭了胆小的侍女。<br>此刻，一个约莫十五六岁，有着古铜肤色的男孩，正坐在辛林城袁府内宅一处不算奢华的房间内，苦着脸想要大哭一场。<br>这个男孩一身雪白色长衫，露出一副玩世不恭的神态，抬头看着那咆哮的雷电，悲呼起来：“老天啊，我只不过是比你长得帅一点，才华稍稍旷古绝今，让你起了些许的妒忌之心，你何苦把我弄到这里来。你把我弄到这里来没关系，我不怪你。可是也要给我一个适合我英俊外表的身份吧？起码家财万贯，喽罗一堆，美女宝贝要多有多少，我只要这些就够了，我又不是贪心的人。可是你让我变成了一个和白痴差不多的傻逼，这也太不仗义了。”<br>这个仰天长叹的少年乃是袁府的六公子袁晔，从小不学无术，才十六岁就仗着家世，整日带着一群狗奴才上街调戏良家妇女。恶名昭住，就在刚才老天开眼，一个雷电，将袁晔的三魂七魄劈了。可是老天不开眼的是，这雷电居然将一个杯具男的魂魄带到了这里。<br>杯具男怎么也想不到，玩网游，看限量真人版可以玩到被电死的地步。<br>一个狐朋狗趁着酒性非要在自己玩网游的时候看U盘里面，和女友的限量真人版。他妈的你变态我也就忍了，干嘛非要把电线扯短路，还把扯断的电线和酒弄到了自己身上。没有疼痛，也没能见到那有没被戴绿帽子的上帝，却被他抛弃到这诡异的世界。杯具男一度怀疑，上帝那混蛋，是不是怕他老婆被自己勾而走，这才把他抛到这世界来。<br>恩，一定是这样。<br>如今已经化成袁晔的杯具男突然站起来，指着天空大骂：“我长得帅你就电死我，我日你先人板板。（我一直不明白板板是什么意思，在古龙小说里，只要四川大盗一出场他就会说：那个谁谁，我日你先人板板。一直到有一天，一个四川兄弟告诉我，板板就是棺材板，棺材板上日他先人，这是何等波澜壮阔的场景。）卖电线的，我日你先人板板！你他妈竞买假冒伪劣产品，小爷玩个网游，你电线一扯就断，一下把我干到这里。”<br>“六公子，家主要您马上去斗士广场。”突然外面响起了一道沙哑的老者声音。<br>这老者正是袁家的老管家，服侍袁家几十年了，对袁家家主袁静之言听计从，袁晔八兄弟中，对老三最是尊重，对他袁晔却是不怎么放在眼里。<br>其实不只是老管家，袁府所有人都不太把袁晔当回事。说起来，袁府算是这辛林城比较有名的地世家，袁府家主袁静之乃是辛林城城主的好友，本身又有不俗的实力，在辛林城颇有影响力。作为他的儿子，袁晔原本应该颇受尊敬，但是过去的袁晔整日不学无术，胸无大志，修炼一塌糊涂，比普通人强不了多少。<br>在烈焰大陆，你可以好色、可以贪婪、可以无耻、可以虚伪，但是你绝不可以胸无大志，不想成为强者。弱小是这个世界最大的罪，如果你没有什么实力，即使有再大的背景也一样会被人看不起。<br>在袁家，父亲兄弟早已对自己失望透顶，而家里的奴才，表面上对他毕恭毕敬，暗地里也是鄙视他，袁家为他提供了极好的修炼条件，可是他死活不修炼。<br>袁晔本人也是破罐子破摔，不喜欢修炼，就是不修炼。<br>所以杯具男在知道自己的身体是这么一个货色之后，仰天长叹，落泪不已。虽然杯具男在地球也是一个学习不好的男生，但起码杯具男从来不自暴自弃，破罐子破摔啊。<br>“六公子，您在屋里吗？”老管家看袁晔久久不回应，又敲了几下门。<br>“急什么，没看见我在感慨人生吗，公子我可是大忙人。”袁晔打开房门，撑开雨伞，看了一眼老管家，直接朝辛林城中心走去。<br>雨下的有点猛，即使有伞，衣服也被淋湿了，袁晔无所谓的穿过袁家细长的花园小路，走出袁家。因为已经融合了从前的记忆，所以现在的袁晔大概知道今天为什么要去斗士广场。<br>袁晔所处的这个世界是万千世界中最强的一界，名叫玄机界，玄机界的最强者被称为元尊。元尊之强，普天之下未有人能敌，世间强者纷纷依附。三万年前，玄机界八大元尊展开旷古绝今的大会战，一时间，山河破碎、血流成河。其中尤以烈焰元尊和冰魄元尊战斗最为惨烈，甚至两位元尊也相继陨落。自此依附烈焰元尊的强者和依附冰魄元尊的强者便世代征伐，仇恨不断积累，及至今日，已是仇深似海，不共戴天。<br>玄机界共有八块大陆，其中地处正南的烈焰大陆和地处西南的冰魄大陆自从两位元尊同归于尽后，连年厮杀。两块大陆的交界处，分别是烈焰大陆的耀炎府和冰魄大陆的凉鑫府，两府之间更是血杀千里，不可共日。一个个强者在这修罗战场陨落，一个个新的强者在这里诞生，整个玄极界无数屹立于武力巅峰的强者从这里走了出去。<br>这里是死亡的乐园、血的海洋，更是英雄传奇的世界、巅峰强者的摇篮！<br>袁晔所处的辛林城，正处于这块地方，辛林城虽然只是烈焰大陆混罗州杞子郡一座极为普通的小城，但是辛林城的名声却是每一个混罗州的人都听过，因为这里曾经诞生过一位名叫寇义的烈焰斗士。<br>八块大陆的至强者被尊称为元素斗士，其中尤以烈焰斗士和冰魄斗士是在修罗战场中杀出来而，其恐怖更胜其他六大元素斗士。每一个烈焰斗士都是所有烈焰大陆武者崇拜的对象，是有志者的奋斗目标。可惜整个烈焰大陆，人口何止百亿，烈焰斗士却不足一千，平均千万人中都出现不了一位！<br>袁晔要去的斗士广场，就是为烈焰斗士寇义所建。<br>袁晔来到斗士广场，一眼就看到了广场中央那座座高达百米的巨型雕像。此刻在那雕像下面已经聚集了万名围观者，雷雨丝毫没有影响他们膜拜的激情。而雕像之下也已经站立了不下于百人，这百人无一不是有身份的。<br>今天是辛林城的大英雄寇义成为烈焰斗士的千年纪念日，按照规矩，这千年纪念日，就是杞子郡的郡王都要来膜拜寇义，到了万年纪念日，甚至于连混罗州州主都会来。<br>远远的，袁晔就看到袁家家主袁静之指着那雕像对自己的七子耐心说教道：“老七，你要虔诚的膜拜，这不只是做做形式，而是要你将强者之心深植到灵魂，只有这样你才能成为一个合格的武者。我一直没有放弃你，所以你也不要放弃。”";

    //$scope.book.content = "<p>“这些事情狱医会解决，你就不用操心了，请回吧。”小光态度委婉。</p><p>“你就告诉我嘛，小哥，我是他的好朋友，关心一下好朋友也是分内之事不是？”</p><p>这时，中年男似乎认出了杨涛，便掐断了烟，来到小光的柜台。</p><p>“怎么又是你？都告诉你，韩刚已经生病了，不适合探视，能探视肯定会给你们看，猴急个啥？”中年男似乎有些怀疑杨涛别有用心。</p><p>“我们就看一下下，可以吗？大哥。”杨涛寻着一个空档，将一叠钱递给了中年男。</p><p>中年男干咳了几下，说道：“兄弟啊，不是哥我不帮你，只是这韩刚的确有病，不能探监，上头的命令，不好意思了。</p><p>中年男子从那叠钱里抽出了几张，递给了小光，剩下的便占为己有，然后离开了柜台。</p><p>“喂，哥，哥！不够我还有啊！哥！”杨涛大喊道。</p><p>然而那中年男占到便宜以后，故意走进了里间，试图摆脱杨涛。</p><p>“这个混蛋，等会我就会让你知道，欺负我是什么下场！”杨涛埋怨道。</p><p>这时，韩菲儿从外面走了进来。</p><p>杨涛看到监狱里面的电还没有断掉，就知道肯定出事了，便拉着韩菲儿来到了一旁。</p><p>“怎么还不动手，我这边已经尽量再给你争取机会了，如果现在还不动手，我们就没有机会了。”杨涛说道。</p><p>韩菲儿着急地要哭了</p><p>“对不起，我忘记路线了。”韩菲儿眼看眼泪就要落下来了。</p><p>如果换作其他人，杨涛绝对大为光火，但毕竟韩菲儿还是第一次做这种事情，他就安慰了一下。</p><p>“算了，还是我去吧，你试试能不能搞定那年轻人或者中年秃顶男，他们不让我去探视你哥，说是生病了，不过……多半是幌子，你就试试看，不行我再另想办法。”</p>";

  $scope.$on('$ionicView.afterEnter', function (event, viewData) {
    JobReader.init_reader();
  });
  //定义电子书目录视图
  $ionicModal.fromTemplateUrl('templates/book-menu.html', {
    scope: $scope,
  }).then(function(modal) {
    $scope.bookmenu = modal;
  });
  $scope.showmenu = function () {
    console.log('bookshow');
    $scope.bookmenu.show();
    pageAction.hide();
  }
  $scope.menulist = [{'title':'第一章 横空出世','id':'1'},{'title':'第一章 家族弃婴','id':'2'}];
  $scope.tomenu = function(e){
    console.log(e);
    $scope.bookmenu.hide();
    //JobReader.init_reader();
    //$scope.book.content = "<p>“这些事情狱医会解决，你就不用操心了，请回吧。”小光态度委婉。</p><p>“你就告诉我嘛，小哥，我是他的好朋友，关心一下好朋友也是分内之事不是？”</p><p>这时，中年男似乎认出了杨涛，便掐断了烟，来到小光的柜台。</p><p>“怎么又是你？都告诉你，韩刚已经生病了，不适合探视，能探视肯定会给你们看，猴急个啥？”中年男似乎有些怀疑杨涛别有用心。</p><p>“我们就看一下下，可以吗？大哥。”杨涛寻着一个空档，将一叠钱递给了中年男。</p><p>中年男干咳了几下，说道：“兄弟啊，不是哥我不帮你，只是这韩刚的确有病，不能探监，上头的命令，不好意思了。</p><p>中年男子从那叠钱里抽出了几张，递给了小光，剩下的便占为己有，然后离开了柜台。</p><p>“喂，哥，哥！不够我还有啊！哥！”杨涛大喊道。</p><p>然而那中年男占到便宜以后，故意走进了里间，试图摆脱杨涛。</p><p>“这个混蛋，等会我就会让你知道，欺负我是什么下场！”杨涛埋怨道。</p><p>这时，韩菲儿从外面走了进来。</p><p>杨涛看到监狱里面的电还没有断掉，就知道肯定出事了，便拉着韩菲儿来到了一旁。</p><p>“怎么还不动手，我这边已经尽量再给你争取机会了，如果现在还不动手，我们就没有机会了。”杨涛说道。</p><p>韩菲儿着急地要哭了</p><p>“对不起，我忘记路线了。”韩菲儿眼看眼泪就要落下来了。</p><p>如果换作其他人，杨涛绝对大为光火，但毕竟韩菲儿还是第一次做这种事情，他就安慰了一下。</p><p>“算了，还是我去吧，你试试能不能搞定那年轻人或者中年秃顶男，他们不让我去探视你哥，说是生病了，不过……多半是幌子，你就试试看，不行我再另想办法。”</p>";
    //JobReader.refurbish();
    $scope.book.content = "<p>“这些事情狱医会解决，你就不用操心了，请回吧。”小光态度委婉。</p><p>“你就告诉我嘛，小哥，我是他的好朋友，关心一下好朋友也是分内之事不是？”</p><p>这时，中年男似乎认出了杨涛，便掐断了烟，来到小光的柜台。</p><p>“这些事情狱医会解决，你就不用操心了，请回吧。”小光态度委婉。</p><p>“你就告诉我嘛，小哥，我是他的好朋友，关心一下好朋友也是分内之事不是？”</p><p>这时，中年男似乎认出了杨涛，便掐断了烟，来到小光的柜台。</p><p>“这些事情狱医会解决，你就不用操心了，请回吧。”小光态度委婉。</p><p>“你就告诉我嘛，小哥，我是他的好朋友，关心一下好朋友也是分内之事不是？”</p><p>这时，中年男似乎认出了杨涛，便掐断了烟，来到小光的柜台。</p><p>“怎么又是你？都告诉你，韩刚已经生病了，不适合探视，能探视肯定会给你们看，猴急个啥？”中年男似乎有些怀疑杨涛别有用心。</p><p>“我们就看一下下，可以吗？大哥。”杨涛寻着一个空档，将一叠钱递给了中年男。</p><p>中年男干咳了几下，说道：“兄弟啊，不是哥我不帮你，只是这韩刚的确有病，不能探监，上头的命令，不好意思了。</p><p>中年男子从那叠钱里抽出了几张，递给了小光，剩下的便占为己有，然后离开了柜台。</p><p>“喂，哥，哥！不够我还有啊！哥！”杨涛大喊道。</p><p>然而那中年男占到便宜以后，故意走进了里间，试图摆脱杨涛。</p><p>“这个混蛋，等会我就会让你知道，欺负我是什么下场！”杨涛埋怨道。</p><p>这时，韩菲儿从外面走了进来。</p><p>杨涛看到监狱里面的电还没有断掉，就知道肯定出事了，便拉着韩菲儿来到了一旁。</p><p>“怎么还不动手，我这边已经尽量再给你争取机会了，如果现在还不动手，我们就没有机会了。”杨涛说道。</p><p>韩菲儿着急地要哭了</p><p>“对不起，我忘记路线了。”韩菲儿眼看眼泪就要落下来了。</p><p>如果换作其他人，杨涛绝对大为光火，但毕竟韩菲儿还是第一次做这种事情，他就安慰了一下。</p><p>“算了，还是我去吧，你试试能不能搞定那年轻人或者中年秃顶男，他们不让我去探视你哥，说是生病了，不过……多半是幌子，你就试试看，不行我再另想办法。”</p>";

    $scope.menulist = [{'title':'第一章 横空出世','id':'1'},{'title':'第一章 家族弃婴','id':'2'}];
  }

  $scope.showMessage = function(){
    console.log(222);
  }
  $scope.readback = function(){
    $ionicHistory.goBack();
  }
  $scope.$on('ngHtmlFinished', function (ngRepeatFinishedEvent) {
    JobReader.refurbish();
    console.log(333);
  });
})
/**
 * [学习记录成绩查询页面]
 * [by潘]
 */
.controller('SearchCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading,$rootScope) {
  $ionicLoading.show({
      template: 'Loading...'
  });
  $scope.userid = window.localStorage['userid'];
  //教学计划
  Websites.getSearchlist($scope);
  $ionicLoading.hide();
})
/**
 * [我的笔记]
 * [by潘]
 */
.controller('NoteCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading,$rootScope,$ionicScrollDelegate,$timeout) {
  $ionicLoading.show({
      template: 'Loading...'
  });
  $scope.selected = false;
  userid = window.localStorage['userid'];
  //教学计划
  Websites.getNotelist($scope,userid).success(function(data){
    $scope.notelist = data;
  });
  $ionicLoading.hide();
  //删除笔记
  $scope.deletenote = function(index1,index2,id){
    Websites.DeleteNote($scope,id).success(function(data){
      //删除成功
      if(data.flag==1){
        var str = $scope.notelist[index1].detail;
        str.splice(index2,1);
        $scope.notelist[index1].num = $scope.notelist[index1].num-1;
        if($scope.notelist[index1].num==0){
          $scope.notelist.splice(index1,1);
        }
        $scope.setscroll();
      }else{
        //删除失败
        $ionicLoading.show({
          template: '删除出错'
        });
        $timeout(function() {
          $ionicLoading.hide();
        }, 1000);
      }
    })
  }
  //重置滚动条
  $scope.setscroll = function(){
    $ionicScrollDelegate.resize();
  }
})
/**
 * [课程搜索页面]
 * [by潘]
 */
.controller('CourseSearchCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading,$rootScope,$state) {
  $ionicLoading.show({
      template: 'Loading...'
  });
  $scope.searchlist = ["会计基础","学前教育","心理学"];
  $scope.userid = window.localStorage['userid'];
  $scope.search = {};
  //教学计划
  //Websites.getSearchlist($scope);
  $scope.toresult = function(){
    //console.log('toresult');
    //console.log($scope.search);
    $state.go('tab.result', {content:$scope.search.value});
  }
  $ionicLoading.hide();
})
/**
 * [用户注册页面]
 * [by潘]
 */
.controller('RegisterCtrl', function($scope, $state, $ionicPopup, $ionicLoading, $timeout,LoginService) {

    $scope.data = {};
    $scope.timetext = '短信验证码';
    $scope.timeable = false;
    $scope.gotoaccount = function() {
        $state.go("tab.usercenter");
    }
    
    //打开服务条款
    $scope.openagree = function() {
      var alertPopup = $ionicPopup.alert({
          title: '用户服务条款',
          template: '<div >经习近平主席和中央军委批准，中国军队派出工作组于6月2日乘空军飞机赶赴马里加奥地区，代表习主席和中央军委看望慰问执行维和任务的中国官兵，做好遇袭伤亡人员善后和救治工作，协调联合国马里多层面综合稳定特派团和马里政府采取切实措施，确保维和部队安全，有效执行维和任务。工作组由国防部维和事务办公室代主任苏广辉少将带队，成员由解放军总医院的医疗专家和任务部队有关人员组成。中国将继续坚定支持联合国维和行动，坚定反对一切形式的恐怖主义，坚定维护世界和平。</div>',
          okText:'我同意',
          okType:'button-calm'
      });
    };
    //注册
    $scope.register = function() {
        //注册功能
        //检测用户输入
        //判断空的输入
        var code = $scope.data.code;
        var phone = $scope.data.phone;
        var password = $scope.data.password;
        if (checkPhone(phone)&&checkPassword(password)&&checkCode(code)) {
            //提交api，进行注册功能
            LoginService.register(code, phone, password).success(function(data) {
              if(data.success==1){
                $scope.showMessage('注册成功');
                $state.go("tab.usercenter");
              }else{
                $scope.showMessage('注册失败');
              }
            }).error(function(){
              $scope.showMessage('注册出错~！~');
            });
        } else {
          if(!checkPhone(phone)){
            $scope.showMessage('请输入正确手机号！');
          }else if(!checkPassword(password)){
            $scope.showMessage('密码至少6位！');
          }else{
            $scope.showMessage('请输入正确验证码！');
          }
        }
    };
    //验证邮箱
    var checkMail = function(szMail) {
        var szReg = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/;
        var bChk = szReg.test(szMail);
        return bChk;
    }
    //验证手机
    var checkPhone = function(a){
      var str = /^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/i;
      var flag = str.test(a);
      return flag;
    }
    //验证密码
    var checkPassword = function(b){
      var flag = false;
      if(b!=undefined){
        if(b.length>=6){
          flag = true;
        }
      }
      return flag;
    }
    //验证验证码
    var checkCode = function(num){
      var flag = false;
      if(num!=undefined){
        if(!isNaN(num)&&num.length==4){
          flag = true;
        }
      }
      return flag;
    }
    //验证短信发送时间
    var checkTime = function(){
      var flag = false;
      var time = $scope.timetext;
      if(time=='短信验证码'){
        flag = true;
      }
      return flag;
    }
    //发送验证码
    $scope.sendcode = function(){
      var phone = $scope.data.phone;
      if(checkPhone(phone)&&checkTime()){//可以发送验证码
        LoginService.SendCode($scope,$scope.data.phone).success(function(data){
          $scope.showMessage('验证码已发送，注意查收!');
          $scope.timetext = 59;
          $scope.timeable = true;
          $scope.showTime();
        }).error(function(data){
          $scope.showMessage('验证码发送失败!');
        })
      }else{
        //不可以发送验证码
        if(!checkPhone(phone)){
          $scope.showMessage('请输入正确手机号');
        }
      }
    }
    //消息提示
    $scope.showMessage = function(title){
      $ionicLoading.show({
        template: title
      });
      $timeout(function() {
        $ionicLoading.hide();
      }, 1000);
    }
    //短信倒计时
    $scope.showTime = function(){
      if($scope.timetext>0){
        $timeout(function() {
          $scope.timetext--;
          $scope.showTime();
        }, 1000);
      }else{
        $scope.timetext = "短信验证码";
        $scope.timeable = false;
      }
    }
})

/**
 * [课程搜索结果]
 * [by潘]
 */
.controller('ResultCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading,$rootScope, $state,$ionicHistory) {
  console.log($stateParams);
  $scope.course_empty = "";
  $ionicLoading.show({
      template: 'Loading...'
  });
  $scope.result = {'value':$stateParams.content};
  Websites.getCourseBykey($scope, $stateParams.content).success(function(data) {
      console.log('success');
      var list = data.responseData;
      if(list.length==0){
        $scope.course_empty = "搜索结果为空";
      }
      $ionicLoading.hide();
    }).error(function(data){
      //加载失败
      console.log('failure');
      $ionicLoading.hide();
  });
  //$scope.resultlist = [{'img':'http://10.82.97.236/mynepapp/www/img/cnsc_mbimg.png','name':'技能《出纳速成》','teacher_names':'陈聪','class_time':'2','free':'0','price':'20'},{'img':'','name':'技能《出纳速成》','teacher_names':'陈聪','class_time':'2','free':'1','price':'30'}];
  console.log($scope.resultlist);
  $scope.doresult = function(){
    $scope.course_empty = "";
    $ionicLoading.show({
      template: 'Loading...'
    });
    Websites.getCourseBykey($scope, $scope.result.value).success(function(data) {
      console.log('success');
      var list = data.responseData;
      if(list.length==0){
        $scope.course_empty = "搜索结果为空";
      }
      $ionicLoading.hide();
    }).error(function(data){
        //加载失败
        console.log('failure');
        $ionicLoading.hide();
    });
  }
  $scope.goBack = function() {
    //$ionicNavBarDelegate.back();
    $ionicHistory.goBack(-2);
  };
})
/**
 * [课程列表]
 * [by潘]
 */
.controller('CourselistCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading,$rootScope, $state) {
  /*if (localStorage.haslogin != 1) {
        $state.go("tab.account");
  }*/
  $ionicLoading.show({
    template: '数据加载中...'
  });
  console.log('CourselistCtrl');
  var type_id = $stateParams.id;

  //加载分页默认配置
  var coursepage = 0;
  var courselimit = '6';

  $scope.course_title = $stateParams.name;
  $scope.course_empty = "";

  //加载更多配置true：是，false：否，默认不开启
  $scope.moreDataCanBeLoaded = false;

  //获取课程
  Websites.getCourselist($scope, type_id,coursepage,courselimit).success(function(data) {
      console.log('success');
      var courselist = data.responseData;
      $scope.courselist = courselist;
      //var list = data.responseData;
      if(courselist.length==0){
        $scope.course_empty = "暂无数据";
      }
      //返回数据数量与分页数量一致，开启加载更多配置
      if(courselist.length == courselimit){
        $scope.moreDataCanBeLoaded = true;
      }
      $ionicLoading.hide();
  }).error(function(data){
      //加载失败
      $scope.course_empty = "加载失败";
      console.log('failure');
      $ionicLoading.hide();
  });

  //加载更多
  $scope.loadMore = function() {
    console.log('loadmore');
    coursepage = coursepage + 1;
    Websites.getCourselist($scope, type_id,coursepage,courselimit).success(function(data) {
      console.log('success');
      for (var i = 0; i <data.responseData.length; i++) {
        $scope.courselist.push(data.responseData[i]);
      };
      console.log(data.responseData);
      console.log($scope.courselist);
      var returnlist = data.responseData;
      if(returnlist.length<6){
        $scope.moreDataCanBeLoaded = false;
      }
      $scope.course_empty = "无更多";
      $scope.$broadcast('scroll.infiniteScrollComplete');
      $ionicLoading.hide();
      
    }).error(function(data){
      //加载失败
      $scope.course_empty = "加载失败";
      console.log('failure');
      $ionicLoading.hide();
    });
  };
  //数据重新加载
  $scope.doRefresh = function() {
    Websites.getCourselist($scope, type_id,'0',courselimit).success(function(data) {
      console.log('success');
      var returnlist = data.responseData;
      if(returnlist.length<6){
        $scope.moreDataCanBeLoaded = false;
      }
      $scope.courselist = data.responseData
      //$scope.course_empty = "无更多";
      $scope.$broadcast('scroll.infiniteScrollComplete');
      $ionicLoading.hide();
      
    }).error(function(data){
      //加载失败
      $scope.course_empty = "加载失败";
      console.log('failure');
    });
    $scope.$broadcast('scroll.refreshComplete');
  }
})
/**
 * [课程更多列表]
 * [by潘]
 */
.controller('CoursefreeCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading,$rootScope, $state) {
  var free = $stateParams.free;
  var title = "畅销好课";
  if(free==1){
    title = "免费好课";
  }
  $scope.course_title = title;
  $ionicLoading.show({
        template: 'Loading...'
  });
  Websites.getCoursefree($scope, free).success(function(data) {
      console.log('success');
      var list = data.responseData;
      if(list.length==0){
        $scope.course_empty = "暂无数据";
      }
      $ionicLoading.hide();
  }).error(function(data){
      //加载失败
      console.log('failure');
      $ionicLoading.hide();
  });
  $scope.doRefresh = function() {
    $ionicLoading.show({
        template: 'Loading...'
    });
    Websites.getCoursefree($scope,free).success(function(data) {
      var list = data.responseData;
      if(list.length==0){
        $scope.course_empty = "暂无数据";
      }
      $ionicLoading.hide();
    }).error(function(data) {
      $ionicLoading.hide();
    });
    //Stop the ion-refresher from spinning
    $scope.$broadcast('scroll.refreshComplete');
  }

  
})
.controller('ProcessCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading,$rootScope,$state) {
  $ionicLoading.show({
      template: 'Loading...'
  });
  $scope.userid = window.localStorage['userid'];
  //$scope.processhide = true;
  Websites.getProcesslist($scope).success(function(data) {
    $ionicLoading.hide();
  }).error(function(data) {
    //$scope.processhide = false;
    $ionicLoading.hide();
  });

  console.log($scope);
  console.log($scope.processlist);
  $scope.doRefresh = function() {
    console.log(1);
    $ionicLoading.show({
        template: 'Loading...'
    });
    Websites.getProcesslist($scope).success(function(data) {
      $ionicLoading.hide();
    }).error(function(data) {
      $ionicLoading.hide();
    });
    //Stop the ion-refresher from spinning
    $scope.$broadcast('scroll.refreshComplete');
  }

})
/**
 * [模拟练习]
 * [by潘]
 */
.controller('MoniCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading,$rootScope,$state) {
  if (localStorage.haslogin != 1) {
        $state.go("tab.usercenter");
  }
  $ionicLoading.show({
      template: 'Loading...'
  });
  var userid = window.localStorage['userid'];
  console.log('MoniCtrl');
  //$scope.processhide = true;
  Websites.getMonilist($scope,userid).success(function(data) {
    $ionicLoading.hide();
  }).error(function(data) {
    $ionicLoading.hide();
  });

  //console.log($scope);
  //console.log($scope.processlist);
  $scope.doRefresh = function() {
    console.log(1);
    $ionicLoading.show({
        template: 'Loading...'
    });
    Websites.getMonilist($scope,userid).success(function(data) {
      $ionicLoading.hide();
    }).error(function(data) {
      $ionicLoading.hide();
    });
    //Stop the ion-refresher from spinning
    $scope.$broadcast('scroll.refreshComplete');
  }

})

/**
 * [答题页面]
 * [by潘]
 */
.controller('QuestionCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading,$ionicSlideBoxDelegate,$ionicPopup,$ionicModal,$ionicHistory,$state,$timeout) {
  if (localStorage.haslogin != 1) {
        $state.go("tab.usercenter");
  }
  console.log('QuestionCtrl');
  $ionicLoading.show({
      template: 'Loading...'
  });
  $scope.choice = {'0':'A','1':'B','2':'C','3':'D'};
  //定义成绩结果
  $ionicModal.fromTemplateUrl('templates/question-result.html', {
    scope: $scope
  }).then(function(modal) {
    $scope.modal = modal;
    //$scope.modal.show();
  });
  $scope.qindex = 1;
  $scope.rate = '0';
  $scope.pagetitle = '练习';
  $scope.isUpActive = false;
  $scope.isDownActive = true;
  //定义答题卡
  $ionicModal.fromTemplateUrl('templates/question-card.html', {
    scope: $scope
  }).then(function(modal) {
    $scope.card = modal;
  });
  Websites.getQuestion($scope).success(function(data){
        if(data['total']==0){
          $ionicLoading.hide();
          var alertPopup = $ionicPopup.alert({
              title: '提示框',
              template: '该试卷暂时无法练习，请联系老师',
              buttons: [{ //Array[Object] (可选)。放在弹窗footer内的按钮。
                  text: 'OK',
                  type: 'button-calm',
              }]
          });
          alertPopup.then(function(res) {
            //console.log('Thank you for not eating my delicious ice cream cone');
            $ionicHistory.goBack();
          });
        }else{
          $timeout(function() {
            $scope.pagetitle = data['pagetitle'];
          });
          $scope.questions = data['question'];
          $scope.total = data['total'];
          
          $scope.cardlist = data['card'];
          $scope.params = data['params'];
          $ionicSlideBoxDelegate.update();
          $ionicLoading.hide();
        }
  })

  $scope.slideHasChanged = function(index){
    var num = $scope.total;
    $scope.qindex = index+1;
    $scope.rate =  index/(num-1)*100-4;
    //翻页判断按钮颜色
    if(index+1==num){
      $scope.isDownActive = false;
    }else{
      $scope.isDownActive = true;

    }
   
    if(index!=0){
      $scope.isUpActive = true;
    }else{
      $scope.isUpActive = false;

    }
    //window.localStorage[pinde] = $ionicSlideBoxDelegate.currentIndex();

  }
  $scope.showcard = function(){
    /*var answerlist = $scope.questions;
    var cardlist = new Array();
    var q_type = '',i = 0;
    for (var q in answerlist){
      i++;
      q_type = answerlist[q]['type_id'];
      q_name = answerlist[q]['type_name'];
      if(!(cardlist[q_type] instanceof Array)) {
        cardlist[q_type] = new Array();
        console.log(cardlist);
        cardlist[q_type][i] = i;
      }else{
          cardlist[q_type][i] = i;
      }
    }
    console.log(cardlist);
    $scope.cardlist = cardlist;*/
    $scope.card.show();
  }
  $scope.toquestion = function(id){
    $ionicSlideBoxDelegate.slide(id-1);
    $scope.card.hide();
  }
  $scope.hidecard = function(){
    $scope.card.hide();
  }
  //上一题
  $scope.previous = function(){
    $ionicSlideBoxDelegate.previous();
  }
  //下一题
  $scope.next = function(){
    $ionicSlideBoxDelegate.next();
  }
  $scope.change = function(){

  }
  $scope.setanswer = function(id,val,qnum,qtype){
    console.log(qnum);
    /*$http({
        method: 'POST',
        url: ENV.postUrl + 'apipractice/setanswer',
        data:{id:id,answer:val}
      }).then(function successCallback(res) {
          console.log($scope.item)
      }, function errorCallback(response) {
    });*/
    $http.jsonp(ENV.apiUrl + 'mobilepractice/setanswer?id='+id+'&&answer='+val+'&&callback=JSON_CALLBACK').then(function(res){
      $scope.cardlist[qtype][qnum+1]['do'] = 'done';
    })

  }
  $scope.setanswercheckbox = function(id,val,qnum,qtype){
      console.log(id+'message'+val);
      $http.jsonp(ENV.apiUrl + 'mobilepractice/Setanswercheckbox?id='+id+'&&answer='+val+'&&callback=JSON_CALLBACK').then(function(res){
        $scope.cardlist[qtype][qnum+1]['do'] = 'done';
      })
      /*$http({
        method: 'POST',
        url: ENV.postUrl + 'apipractice/Setanswercheckbox',
        data:{i:id,answer:val}
      }).then(function successCallback(res) {
          // this callback will be called asynchronously
      }, function errorCallback(response) {
          // called asynchronously if an error occurs
      });*/
    }
  $scope.repeat = function(){
    $scope.modal.hide();
    $ionicLoading.show({
      template: 'Loading...'
    });
    Websites.getQuestion($scope).success(function(data){
        if(data['total']==0){
          $ionicLoading.hide();
          var alertPopup = $ionicPopup.alert({
              title: '提示框',
              template: '该试卷暂时无法练习，请联系老师',
              buttons: [{ //Array[Object] (可选)。放在弹窗footer内的按钮。
                  text: 'OK',
                  type: 'button-calm',
              }]
          });
          alertPopup.then(function(res) {
            //console.log('Thank you for not eating my delicious ice cream cone');
            $ionicHistory.goBack();
          });
        }else{
          $timeout(function() {
            $scope.pagetitle = data['pagetitle'];
          });
          $scope.questions = data['question'];
          $scope.total = data['total'];
          $scope.cardlist = data['card'];
          $scope.params = data['params'];
          $ionicSlideBoxDelegate.update();
          $ionicSlideBoxDelegate.slide(0);
          $scope.qindex = 1;
          $scope.rate =  "0";
          $timeout(function() {
            $ionicLoading.hide();
          }, 2000);
        }
    })
  }
  $scope.setanswertext = function(id,val,qnum,qtype){
    console.log(id);
    console.log(val);
    if(val!=""&&val!=undefined){
      $http.jsonp(ENV.postUrl + 'apipractice/settextanswer/id/'+id+'/answer/'+val+'?callback=JSON_CALLBACK').then(function(res){
        $scope.cardlist[qtype][qnum+1]['do'] = 'done';
      })
    }
  }
  /**
     * 交卷
     * @return {[type]} [description]
  **/
    $scope.doSubmitPhase = function(t_id,pageid){
      console.log('submitphase');
        var confirmPopup = $ionicPopup.confirm({
          title: '交卷',
          template: '确定提交本次测验?',
            
          buttons: [{ //Array[Object] (可选)。放在弹窗footer内的按钮。
            text: 'Cancel',
            type: 'button-balanced',
          }, {
            text: 'OK',
            type: 'button-calm',
            onTap: function(e) {
              // 返回的值会导致处理给定的值。
              return true;
            }
          }]
      });
      confirmPopup.then(function(res) {
        if(res) {
            console.log('You are sure');
            //Edetail.submitphase.get({userid:window.localStorage['userid'],t_id:t_id,pageid:pageid});
            //$location.path('/app/pageresult/userid/'+window.localStorage['userid']+'/t_id/'+t_id);
            $scope.modal.show();
            $scope.card.hide();
            Websites.getResult($scope).success(function(data) {
              $scope.result = data;
            }).error(function(data) {
            });
            $scope.examurl = '/tab/practice';
            //window.localStorage['examurl'] = '/app/phaselist';
        }else{
            console.log('You are not sure');
        }
      });
    }
  $scope.gourl = function(url){
    console.log(url);
    $location.path(url);
    $scope.modal.hide();
  }
  $scope.resultback = function(){
    console.log('resultback');
    $state.go("tab.practice");
    $scope.modal.hide();
  }
})
.controller('ViewCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading,$state) {
  if (localStorage.haslogin != 1) {
        $state.go("tab.usercenter");
  }
  console.log('ViewCtrl');
  $ionicLoading.show({
      template: 'Loading...'
  });
  $scope.userid = window.localStorage['userid'];
  $scope.planid = $stateParams.planid;
  $scope.courseid = $stateParams.courseid;
  //获取学习进度详细
  Websites.getProcessview($scope).success(function(data) {
    $ionicLoading.hide();
  }).error(function(data) {
    $ionicLoading.hide();
  });
})
.controller('DetailCtrl', function($scope,$stateParams,Websites,$http,$ionicLoading,$state) {
  if (localStorage.haslogin != 1) {
        $state.go("tab.usercenter");
  }
  console.log('DetailCtrl');
  $scope.detailerror = "";
  $ionicLoading.show({
      template: 'Loading...'
  });
  $scope.userid = window.localStorage['userid'];
  $scope.title = $stateParams.title;
  $scope.item_track_id = $stateParams.item_track_id;
  //获取学习进度详细
  Websites.getProcessDetail($scope).success(function(data) {
    console.log($scope.detail);
    if($scope.detail.length==0){
      $scope.detailerror = "暂无数据";
    }
    $ionicLoading.hide();
  }).error(function(data) {
    $ionicLoading.hide();
  });
})


/**
 * 用户中心
 * @param  {[type]} $scope  [description]
 * @param  {[type]} $state) {             if (localStorage.haslogin ! [description]
 * @return {[type]}         [description]
 */
.controller('UsercenterCtrl', function($scope, $state,LoginService,$ionicLoading,$ionicPopup) {
  $scope.data = {};
    //强制显示返回button，默认情况下tabs里面独立页面不显示back button
    $scope.$on('$ionicView.beforeEnter', function (event, viewData) {
      viewData.enableBack = false;
    });
    if (localStorage.haslogin == 1) {
        $state.go("tab.account");
    }

    $scope.login = function() {
        console.log($scope.data.username);
        
        LoginService.loginUser($scope.data.username, $scope.data.password).success(function(data) {
            //登录成功
            localStorage.haslogin = 1;
            $ionicLoading.hide();
            $state.go("tab.account");
            console.log(1);

        }).error(function(data) {
            console.log('error login');
            localStorage.haslogin = 0
            var alertPopup = $ionicPopup.alert({
                title: '登录失败',
                okType: 'button-calm',
                okText: '确定',
                template: '请检查您填写的登陆信息！'
            });
        });
    }

    $scope.forget = function() {
        //进行API提交后，发送邮件，发送成功后，进行alert提醒
        $state.go('resetpassword');
    }

    $scope.goregister = function() {
        $state.go('register');
    }

  /*$scope.user = {
    id:12,
    img:'http://127.0.0.1/mynepapp/www/img/u_02.png',
    name:'尚未登录'
    //name:'李元熙'
  };*/
})

/**
 * 首页控制器
 */
.controller('HomeCtrl', function($scope, Websites, $ionicLoading, $ionicSlideBoxDelegate,$ionicSideMenuDelegate,$stateParams){
  var catId = $stateParams.catId == null ? localStorage.catId : $stateParams.catId;
  console.log(catId);
  //得到指定分类名称
  //Websites.getCategoryById($scope,catId);
  if(typeof(localStorage.categorystr) == 'undefined'){
      Websites.getCategory($scope).success(function(data){
          var categorystr = localStorage.categorystr;
          var categoryarr = JSON.parse(categorystr);

          if(catId == null || typeof(catId) == 'undefined'){
              catId = categoryarr[0].id;
          }

          for(var i in categoryarr){
              if(categoryarr[i].id == catId){
                  $scope.category = categoryarr[i];
                  console.log($scope.category);
                  break;
              }
          }
      });
  }else{
      var categorystr = localStorage.categorystr;
      var categoryarr = JSON.parse(categorystr);

      if(catId == null || typeof(catId) == 'undefined'){
          catId = categoryarr[0].id;
      }

      for(var i in categoryarr){
          if(categoryarr[i].id == catId){
              $scope.category = categoryarr[i];
              console.log(catId);
              console.log($scope.category);
              break;
          }
      }
  }
  
  
  
  //强制隐藏返回button，默认情况下tabs里面独立页面不显示back button
  $scope.$on('$ionicView.beforeEnter', function (event, viewData) {
      viewData.enableBack = false;
  });
  //var catId = $stateParams.catId;
  $ionicLoading.show({
      template: '数据加载中...'
  });
  //设置banner模块
  Websites.getBanner($scope);

  //设置课程模块
  Websites.indexData($scope,catId).success(function(data) {
    $ionicLoading.hide();
    $ionicSlideBoxDelegate.update();
  }).error(function(data){
    //加载失败
    $ionicLoading.hide();
  });

  $scope.doRefresh = function() {
    Websites.indexData($scope);
    //Stop the ion-refresher from spinning
    $scope.$broadcast('scroll.refreshComplete');
  };

  $scope.openMenu = function () {
    $ionicSideMenuDelegate.toggleLeft();
    console.log(localStorage.haslogin);  
  }
})

.controller('AllCourseCtrl', ['$scope', 'Websites', '$ionicLoading', '$state','$ionicSideMenuDelegate', function($scope, Websites, $ionicLoading, $state,$ionicSideMenuDelegate){
  $ionicLoading.show({
      template: '数据加载中...'
  });
  Websites.getAllCourse($scope).success(function(data) {
                console.log(data);

    $ionicLoading.hide();
  }).error(function(data) {
    $ionicLoading.hide();
  });
  $scope.openMenu = function () {
    $ionicSideMenuDelegate.toggleLeft();
  }
  $scope.tosearch = function(){
    $state.go("tab.search");
    console.log("tab.search");
  }
}])

/**
 * [登录类控制器：登录、忘记密码、注册等]
 * @param  {[type]} $scope          [description]
 * @param  {[type]} LoginService    [description]
 * @param  {[type]} $ionicPopup     [description]
 * @param  {[type]} $state          [description]
 * @param  {[type]} $ionicLoading   [description]
 * @param  {[type]} $window         [description]
 * @param  {Object} $ionicPlatform) {               $scope.data [description]
 * @return {[type]}                 [description]
 */
.controller('AccountCtrl', function($scope, LoginService, $ionicPopup, $state, $ionicLoading, $window, $ionicPlatform,Websites) {
    console.log('AccountCtrl');
  $scope.login = localStorage.haslogin;
  console.log($scope.login);
  if (localStorage.haslogin != 1) {
    $state.go("tab.usercenter");
  }else{
      /*Websites.getUserDetail($scope,window.localStorage['userid']).success(function(){
          $scope.detail = true;
      });*/
      $scope.name = localStorage.username;
      $scope.hide = true;
      $scope.settings = {
        enableFriends: true
      };
      
      $scope.toregister = function(){
        console.log(11);
      }
  }    
})

/**
 * 新闻详细信息
 * @param  {[type]} $scope      [description]
 * @return {[type]}             [description]
 */
.controller('NewsCtrl', ['$scope', 'Websites', '$stateParams', '$ionicLoading', '$ionicHistory', function($scope, Websites, $stateParams, $ionicLoading, $ionicHistory){
    $ionicLoading.show({
        template: '数据加载中...'
    });
    
    var newsid = $stateParams.newsid;
    Websites.getNewsdetail($scope, newsid).success(function(data) {
      console.log('success');
      $ionicLoading.hide();
    }).error(function(data){
      //加载失败
      console.log('failure');
      $ionicLoading.hide();
    });

    //强制显示返回button，默认情况下tabs里面独立页面不显示back button
    /*$scope.$on('$ionicView.beforeEnter', function (event, viewData) {
        viewData.enableBack = true;
    });

    $scope.gotoaccount = function() {
      $ionicHistory.goBack();
    }*/
}])


//   Sam   ------ 错题集列表控制器
.controller('ErrorlistCtrl', function($scope, $ionicPopup, $state, $ionicLoading, $ionicPlatform,Websites,$http) {
    var userid = window.localStorage['userid'];
    Websites.getErrorlist($scope,userid).success(function(data) {
      //$ionicLoading.hide();
      console.log(data);
    }).error(function(data){
      //加载失败
      $ionicLoading.hide();
    });
    $scope.errortype = {'0':'单项选择题','1':'多项选择题','2':'判断题','3':'课题解析'};
    //Sam   --------删除错题列表
    $scope.onItemDelete = function(index,courseid){
      var confirmPopup = $ionicPopup.confirm({
            title: '确认删除？',
            cancelText: '取消',
            okText: '确定'
        });
        confirmPopup.then(function(res) {
          if(res) {
            console.log('You are sure');
            Websites.DeleteError($scope,courseid,userid).success(function () {
              $scope.errorlist.splice(index,1);
            })
          }else{
              console.log('You are not sure');
          }
        });
    }

})

//   Sam   ------  错题详细页面
.controller('ErrordetailCtrl', function ($scope,$http,$location,$ionicSlideBoxDelegate,$stateParams,$ionicModal,$ionicLoading,Websites){
  $scope.radio = {checked:''};
  var userid = window.localStorage['userid'];
  var courseid = $stateParams.courseid;
  var coursename = $stateParams.course_name;
  var pageid = $stateParams.pageid;
  $scope.choice = {'0':'A','1':'B','2':'C','3':'D','4':'E','5':'F'};
  Websites.ErrorDetail($scope,courseid,pageid,userid).success(function(res){
    $scope.questions = res['question'];
    $scope.questype = res['questype'];
    $scope.total = res['total'];
    $scope.cardlist = res['card'];
    $scope.pagetitle = res['pagetitle'];
    $scope.params = res['params'];
    console.log($scope.questions);
    $ionicSlideBoxDelegate.update();
  })
  //Sam------答题卡modal
  $ionicModal.fromTemplateUrl('templates/d.html', {
    scope: $scope
  }).then(function(cards) {
    $scope.cards = cards;
    //$scope.modal.show();
  });
  $scope.toquestion = function(id){
    $ionicSlideBoxDelegate.slide(id-1);
    $scope.cards.hide();
  }
  //Sam------答题卡测试
  $scope.cardsshow = function() {
    console.log($scope.danxuan);
    console.log($scope.total+1);
    //单选题目数量
    $scope.danxuancount = [];
    for(var danxuan = 1; danxuan<$scope.danxuan+1; danxuan++){
      $scope.danxuancount.push(danxuan);
      var danxuanlast = danxuan;
    }
    //多选题目数量
    $scope.duoxuancount = [];
    for(var duoxuan = danxuanlast; duoxuan<$scope.duoxuan+danxuanlast; duoxuan++){
      $scope.duoxuancount.push(duoxuan);
    }
    // console.log($scope.numlist);
    $scope.cards.show();
  }
  // Sam ------ 答题卡跳转
  $scope.redirect = function(value) {
        //接收key key是题目的编号
        // 跳转到指定的题目页面
        // $ionicSlideBoxDelegate.slide(4);
        $scope.cards.hide();
        $ionicSlideBoxDelegate.slide(value-1);
  }
  
  // Sam  ---------  隐藏答题卡
  $scope.cardsHide = function() {
      // console.log('test');
      $scope.cards.hide();
  }
  //  Sam   --------  成绩结果返回按钮
  $scope.examurl = '/practice/errorlist';
  $scope.gourl = function(url){
      $location.path(url);
      $scope.modal.hide();
    }
})


//  Sam   ------   个人信息设置页面 
.controller('UserinfoCtrl', function($scope,$http,Websites,$ionicLoading,$ionicHistory,$state) {
  $scope.user = {
    id:12,
    img:'http://127.0.0.1/mynepapp/www/img/u_02.png',
    name:'尚未登录'
    //name:'李元熙'
  };

  Websites.getUserinfo($scope).success(function(data) {
      console.log('success');
      console.log(data);
      $scope.userdata = data.responseData;
      console.log($scope.userdata);
      console.log($scope.userdata[0]['content']);
      if($scope.userdata[0]['content'] == '') $scope.userdata[0]['content'] = './img/u_02.png';
      $scope.headimg = $scope.userdata[0]['content'];
      //$ionicLoading.hide();
    }).error(function(data){
      //加载失败
      console.log('fail');
      $ionicLoading.hide();
    });

  $scope.logout = function () {
    // body...
    localStorage.haslogin = 0;
    $state.go('tab.usercenter');
    //$ionicHistory.goBack();
  }

})


//  Sam   ------   个人信息更改详细页面 
.controller('InfosettingCtrl', function($scope,$ionicLoading,$http,$stateParams,$state,Websites) {
  console.log($stateParams);
  console.log($stateParams.infotype);
  console.log($stateParams.text);

  $scope.user = {
    id:12,
    img:'http://127.0.0.1/mynepapp/www/img/u_02.png',
    name:'尚未登录'
    //name:'李元熙'
  };

  if(window.localStorage['headimg']=='') {
    $scope.headimg = './img/u_02.png';
  } else  $scope.headimg = window.localStorage['headimg'];

  $scope.content = {};
  $scope.content.value = $stateParams.text;

  $scope.save = function(){
    console.log('helo');
    console.log($scope.content.value);
    $http.jsonp(ENV.postUrl + 'Mobileadmin/saveuser?userid=13&field='+$stateParams.infotype+'&usercontent='+$scope.content.value+'&callback=JSON_CALLBACK')
        .then(function(res){
          console.log('suc');
          console.log($scope.content.value);
          $ionicLoading.show({ template: '修改成功', noBackdrop: true, duration: 1000 });
          $state.go('tab.userinfo')
      })
  }

  $scope.userkey = $stateParams.infotype;
  if ($stateParams.infotype == 'avatar')  $scope.title = '头像设置';
  if ($stateParams.infotype == 'name')  $scope.title = '姓名设置';
  if ($stateParams.infotype == 'email')  $scope.title = '电子邮件设置';
  if ($stateParams.infotype == 'mobile')  $scope.title = '移动电话设置';
  if ($stateParams.infotype == 'postcode')  $scope.title = '邮政编码设置';
  if ($stateParams.infotype == 'pass')  $scope.title = '密码设置';
  $scope.key = $stateParams.text;
  $scope.cleartext = function() {
    console.log('textclear');
    $scope.content.value = "";
  }

  $scope.tocamera = function() {
      console.log('tocamera');
      var popover = new CameraPopoverOptions(0, 100, 200, 200, Camera.PopoverArrowDirection.ARROW_ANY);        
        navigator.camera.getPicture(
            /*function (imageURI) {
                var image = document.getElementById('userheadimg');
                image.src = imageURI;
            }*/
            //onPhotoUriSuccess
            function (imageUriToUpload){
                //alert('success');
                /*var image = document.getElementById('userheadimg');
                var userinfolisthead = document.getElementById('userinfolisthead');
                var uIndexPanelhead = document.getElementById('uIndexPanelhead');
                image.src = imageUriToUpload;
                userinfolisthead.src = imageUriToUpload;
                uIndexPanelhead.src = imageUriToUpload;*/

                $scope.headimg = imageUriToUpload;

                var url=encodeURI(postUrl+"mobileadmin/uploadimg");
                var params = new Object();
                params.userid = window.userid;  //you can send additional info with the file
                //alert('upload13');
                var options = new FileUploadOptions();
                options.fileKey = "userimg"; //depends on the api
                options.fileName = imageUriToUpload.substr(imageUriToUpload.lastIndexOf('/')+1);
                options.mimeType = "image/jpeg";
                options.params = params;
                options.chunkedMode = true; //this is important to send both data and files
                var headers={'headerParam':'headerValue'};
                options.headers = headers;
                var ft = new FileTransfer();
                ft.upload(imageUriToUpload, url, 
                    function (r) {
                        /*console.log("Code = " + r.responseCode);
                        alert("Response = " + r.response);
                        alert("Sent = " + r.bytesSent);*/
                    },
                    function (error) {
                        /*alert("An error has occurred: Code = " + error.code);
                        alert("upload error source " + error.source);
                        alert("upload error target " + error.target);*/
                    },
                    options);
            }
            , function (message) {
                //alert('Failed because: ' + message);
            }, { 
                quality: 60,
                destinationType: Camera.DestinationType.FILE_URI,
                sourceType: Camera.PictureSourceType.CAMERA,  //from camera
                allowEdit : true,
                encodingType: Camera.EncodingType.JPEG,
                targetWidth: 300,
                targetHeight: 300,
                popoverOptions  : CameraPopoverOptions,
                sourceType: 1,      // 0:Photo Library, 1=Camera, 2=Saved Photo Album
                encodingType: 0
            }
        );
  }

  $scope.toimagepicker = function() {
      console.log('toimagepicker');
      var popover = new CameraPopoverOptions(0, 100, 200, 200, Camera.PopoverArrowDirection.ARROW_ANY);
        navigator.camera.getPicture(
            /*function (imageURI) {
                var image = document.getElementById('userheadimg');
                image.src = imageURI;
            }*/
            function (imageUriToUpload){
                //alert('success');
                /*var image = document.getElementById('userheadimg');
                image.src = imageUriToUpload;*/
                /*var image = document.getElementById('userheadimg');
                var userinfolisthead = document.getElementById('userinfolisthead');
                var uIndexPanelhead = document.getElementById('uIndexPanelhead');
                image.src = imageUriToUpload;
                userinfolisthead.src = imageUriToUpload;
                uIndexPanelhead.src = imageUriToUpload;*/
                $scope.headimg = imageUriToUpload;

                var url=encodeURI(postUrl+"mobileadmin/uploadimg");
                var params = new Object();
                params.userid = window.userid;  //you can send additional info with the file
                
                var options = new FileUploadOptions();
                options.fileKey = "userimg"; //depends on the api
                options.fileName = imageUriToUpload.substr(imageUriToUpload.lastIndexOf('/')+1);
                options.mimeType = "image/jpeg";
                options.params = params;
                options.chunkedMode = true; //this is important to send both data and files
                var headers={'headerParam':'headerValue'};
                options.headers = headers;
                var ft = new FileTransfer();
                //alert('upload13');
                ft.upload(imageUriToUpload, url, 
                    function (r) {
                        /*alert("Code = " + r.responseCode);
                        alert("Response = " + r.response);
                        alert("Sent = " + r.bytesSent);*/
                    },
                    function (error) {
                        /*alert("An error has occurred: Code = " + error.code);
                        alert("upload error source " + error.source);
                        alert("upload error target " + error.target);*/
                    },
                    options);
            }
            , function (message) {
                //alert('Failed because: ' + message);
            }, { 
                maximumImagesCount: 1,
                quality: 50,
                destinationType: Camera.DestinationType.FILE_URI,
                sourceType: Camera.PictureSourceType.PHOTOLIBRARY, //from photolibrary
                //sourceType: Camera.PictureSourceType.CAMERA, //from photolibrary
                allowEdit : true,
                encodingType: Camera.EncodingType.JPEG,
                targetWidth: 300,
                targetHeight: 300,
                popoverOptions  : popover
            }
        );
  }

})
//Sam   --- 我的课程页面 
.controller('MycourseCtrl', function($scope,$ionicLoading,$http,$stateParams,$state,Websites) {
  console.log('1');
  if (localStorage.haslogin != 1) {
      $state.go("tab.usercenter");
      return;
  }else{
      $scope.courselist = [
        {'id':'1','name':'基金投资指南与实际操作','videocount':'25','ebook':'12','practice':'75',
        'img':'./img/baoban.png','process':'22', },
        {'id':'1','name':'基金投资指南与实际操作','videocount':'25','ebook':'12','practice':'75',
        'img':'./img/baoban.png','process':'22', },
      ];
  }

})

//Sam   --- 报班页面
.controller('ApplycourseCtrl', function($scope,$http,Websites,$ionicLoading,$ionicHistory,$state) {
  console.log('heai');

  $scope.applycourse = [
    {'id':'1','name':'基金投资指南与实际操作','price':'19.9','orginprice':'300','orgin':'0',
    'free':'0','img':'./img/baoban.png',
    'content':'我是演讲咖：3周成为演讲沟通高手（创业职场必备）'},
    {'id':'2','name':'投资陷进大揭秘','price':'50','orginprice':'250','orgin':'0',
    'free':'0','img':'./img/baoban.png',
    'content':'这是测试历史测试测试测试测试测试测试测试测试测试测试测试'}
  ]; 
  console.log($scope.applycourse);

  $scope.tosearch = function(){
    $state.go("tab.search");
    console.log("tab.search");
  }
})

//Sam  ---- 课程包页面
.controller('CoursepageCtrl', function($scope,$http,Websites,$ionicLoading,$ionicHistory,$state) {
  console.log('heai');
  $scope.courselist = [
    {'id':'1','name':'实现财物自由的家庭理财规划','price':'19.9','orginprice':'300','orgin':'0',
    'free':'0','img':'./img/kecheng.png',
    'content':'我是演讲咖：3周成为演讲沟通高手（创业职场必备）'},
    {'id':'2','name':'职场新人如何做理财规划','price':'50','orginprice':'250','orgin':'0',
    'free':'0','img':'./img/kecheng.png',
    'content':'这是测试历史测试测试测试测试测试测试测试测试测试测试测试'}
  ]; 
 
  
})

// Sam  地址页面
.controller('AddressCtrl', function($scope,$http,Websites,$ionicLoading,$ionicHistory,$state) {

  $scope.addresslist = [
    {'id':'1','name':'李晓光','phonenum':'13556987562','choose_mark':'1',
    'text':'浙江省宁波室高新区江南路1192号浙江软件大学学术交流中心北3喽'},
    {'id':'2','name':'大哥大','phonenum':'13826579632','choose_mark':'0',
    'text':'这是测试历史测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试'}
  ]; 

  // console.log($scope.addresslist);

  $scope.flag = true;
  $scope.getMark = function(addressid){
    $scope.flag = false;
    console.log($scope.addresslist[addressid-1]['choose_mark']);

    $scope.addresslist[addressid-1]['choose_mark'] = 3;


    $scope.choose_mark = 1;

  }
 
  
})

//Sam  ---- 课程包页面
.controller('MycollectionCtrl', function($scope,$http,Websites,$ionicLoading,$ionicHistory,$state) {
  console.log('heai');

  $scope.applycourse = [
    {'id':'1','name':'基金投资指南与实际操作','price':'19.9','orginprice':'300','orgin':'0',
    'free':'0','img':'./img/baoban.png',
    'content':'我是演讲咖：3周成为演讲沟通高手（创业职场必备）'},
    {'id':'2','name':'投资陷进大揭秘','price':'50','orginprice':'250','orgin':'0',
    'free':'0','img':'./img/baoban.png',
    'content':'这是测试历史测试测试测试测试测试测试测试测试测试测试测试'}
  ]; 
 
  
})

//Sam  ---- 历史记录
.controller('MyhistoryCtrl', function($scope,$http,Websites,$ionicLoading,$ionicHistory,$state) {

  $scope.applycourse = [
    {
      'id':'1',
      'name':'基金投资指南与实操攻略',
      'price':'19.9',
      'orginprice':'300',
      'orgin':'0',
      'free':'0',
      'img':'./img/baoban.png',
      'content':'第1章 Java初体验',
      'time':'53秒'
    },
    {
      'id':'2',
      'name':'投资陷进大揭秘',
      'price':'50',
      'orginprice':'250',
      'orgin':'0',
      'free':'0',
      'img':'./img/baoban.png',
      'content':'第1章 Java初体验',
      'time':'53秒'
    }
  ]; 
 
  
})

//Sam  ---- 课程答疑、笔记页面
.controller('CoursenoteCtrl', function($scope,$http,Websites,$ionicLoading,$ionicHistory,$state) {
  //back button
  $scope.$on('$ionicView.beforeEnter', function (event, viewData) {
      viewData.enableBack = true;
    });
  
  //返回的动画效果，默认情况下强制显示的返回button无动画效果
  $scope.$on('$ionicView.beforeLeave', function (event, viewData) {
    $ionicViewSwitcher.nextDirection("back");
  });
  //控制内容页高度
  $scope.grid_height = {height:''+document.body.offsetHeight*0.65-104+'px'};
  Websites.directoryData($scope).success(function(data) {
      //$ionicLoading.hide();
    }).error(function(data){
      //加载失败
      $ionicLoading.hide();
  });

    $scope.notelist = [
      {'id':'1','text':'这里要想老师提问的内容',},
      {'id':'2','text':'这里要想老师提问的内容',},
      {'id':'3','text':'这里要想老师提问的内容',},

    ];

    $scope.questionlist = [
      {'id':'1','title':'有现成可以加接入的ERP系统吗',
      'question':'我已经有了网店想接入的erp系统，不知道有没有现成的可以直接接入的？费用大概是多少'},
      {'id':'2','title':'老师您好',
    'question':'ERP系统与网店结合有哪些优点'},
      {'id':'3','title':'老师您好',
    'question':'ERP系统与网店结合有哪些特点'},
    ];

    $scope.timelast = '15:02';

 
})

//Sam  ----  离线换存 下载页面
.controller('DownloadCtrl', function($scope,$http,Websites,$ionicLoading,$ionicHistory,$state) {
  
  //back button
  $scope.$on('$ionicView.beforeEnter', function (event, viewData) {
      viewData.enableBack = true;
    });
  
  //返回的动画效果，默认情况下强制显示的返回button无动画效果
  $scope.$on('$ionicView.beforeLeave', function (event, viewData) {
    $ionicViewSwitcher.nextDirection("back");
  });

  $scope.downloadinglist = [
      {'id':'1','name':'1-8制作证件照','current_size':'6.36m',
      'total_size':'16.35m','speed':'528','process':'23',},
      {'id':'2','name':'1-9给娃干哈关爱和','current_size':'5.6m',
      'total_size':'16.35m','speed':'528','process':'66',},
      {'id':'3','name':'1-5测试测试测试测试','current_size':'6.18m',
      'total_size':'16.35m','speed':'528','process':'66',},

    ];

  $scope.downloadedlist = [
    {'id':'1','name':'基金投资指南与实际操作','price':'19.9','orginprice':'300','orgin':'0',
    'free':'0','img':'./img/baoban.png','cache_num':'2',
    'content':'我是演讲咖：3周成为演讲沟通高手（创业职场必备）'},
    {'id':'2','name':'投资陷进大揭秘','price':'50','orginprice':'250','orgin':'0',
    'free':'0','img':'./img/baoban.png','cache_num':'6',
    'content':'这是测试历史测试测试测试测试测试测试测试测试测试测试测试'}

  ];
 
 
  
})

//Sam  ----  离线换存 二级页面
.controller('DlsecpageCtrl', function($scope,$http,Websites,$ionicLoading,$ionicHistory,$state) {

  //back button
  $scope.$on('$ionicView.beforeEnter', function (event, viewData) {
      viewData.enableBack = true;
    });
  
  //返回的动画效果，默认情况下强制显示的返回button无动画效果
  $scope.$on('$ionicView.beforeLeave', function (event, viewData) {
    $ionicViewSwitcher.nextDirection("back");
  });

  $scope.test = '基金投资指南与实际操作';
  Websites.directoryData($scope).success(function(data) {
      //$ionicLoading.hide();
    }).error(function(data){
      //加载失败
      $ionicLoading.hide();
  });



});
